import{supabase}from"./config.js";document.addEventListener("DOMContentLoaded",(()=>{const o=document.getElementById("graficoNiveis");if(!o)return void console.error("Elemento <canvas> com ID 'graficoNiveis' não encontrado.");const e=o.getContext("2d");let a=[],t={Bloco3:[]},l=new Chart(e,{type:"line",data:{labels:a,datasets:[{label:"Bloco 3",data:t.Bloco3,borderColor:"#e74c3c",backgroundColor:"rgba(231, 76, 60, 0.2)",borderWidth:2,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,ticks:{color:"#7c7878",font:{size:10,weight:"bold"},callback:function(o){return o+"%"}},grid:{color:"#B0B0B0"}},x:{ticks:{color:"#7c7878",font:{size:10,weight:"bold"}},grid:{color:"#B0B0B0"}}},plugins:{title:{display:!0,text:"Nível de Água",font:{size:18},color:"#c0c8fd"},legend:{display:!0,position:"top",labels:{font:{size:11},color:"#c0c8fd",padding:10}}}}});async function s(){console.log("Buscando dados do Supabase...");const{data:o,error:e}=await supabase.from("dados").select("*").eq("id",1383);if(e)console.error("Erro ao buscar dados do Supabase:",e);else if(console.log("Dados retornados pelo Supabase:",o),o&&o.length>0){const e=o[0].payload;if(console.log("Payload retornado:",e),e&&e.dados){const s=e.dados;console.log("Dados extraídos do payload:",s);const n={Bloco3:s.Bloco3.nivel_agua},d={Bloco3:t.Bloco3[t.Bloco3.length-1]};if(n.Bloco3===d.Bloco3)return void console.log("Dados não mudaram. Gráfico não será atualizado.");if(s.Bloco1){const e=new Date(o[0].recebido_em).toLocaleString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});a.push(e),t.Bloco3.push(s.Bloco3.nivel_agua)}a.length>48&&(a.shift(),t.Bloco3.shift()),console.log("Timestamps:",a),console.log("Histórico de Níveis:",t),l.data.labels=a,l.data.datasets[0].data=t.Bloco3,l.update()}else console.error("Payload ou objeto 'dados' não encontrado no retorno do Supabase.")}else console.log("Nenhum dado encontrado no Supabase.")}s(),setInterval(s,1e3)}));