import{supabase}from"./config.js";function updateWaterLevel1(e){e<0&&(e=0),e>100&&(e=100);const t=document.querySelector("#bloco1 .water-container"),o=document.getElementById("water-level1");if(!t||!o)return;const a=t.clientHeight,n=.08*a,r=.78*a,c=n+100*Math.pow(e/100,1.2)/100*(r-n);o.style.height=`${c}px`;const l=document.querySelector("#bloco1 .capsula-nivel");l&&(l.textContent=`${e.toFixed(0)}%`)}function updateVoltimetro1(e){e<0&&(e=0),e>300&&(e=300),animateNeedle(document.getElementById("ponteiro-voltimetro1"),e/300*260);const t=document.querySelector("#bloco1 .capsula-voltimetro");t&&(t.textContent=`${e.toFixed(0)} V`)}function updateAmperimetro1(e){e<0&&(e=0),e>60&&(e=60),animateNeedle(document.getElementById("ponteiro-amperimetro1"),e/60*260);const t=document.querySelector("#bloco1 .capsula-amperimetro");t&&(t.textContent=`${e.toFixed(0)} A`)}function updateWaterLevel2(e){e<0&&(e=0),e>100&&(e=100);const t=document.querySelector("#bloco2 .water-container"),o=document.getElementById("water-level2");if(!t||!o)return;const a=t.clientHeight,n=.08*a,r=.78*a,c=n+100*Math.pow(e/100,1.2)/100*(r-n);o.style.height=`${c}px`;const l=document.querySelector("#bloco2 .capsula-nivel");l&&(l.textContent=`${e.toFixed(0)}%`)}function updateVoltimetro2(e){e<0&&(e=0),e>300&&(e=300),animateNeedle(document.getElementById("ponteiro-voltimetro2"),e/300*260);const t=document.querySelector("#bloco2 .capsula-voltimetro");t&&(t.textContent=`${e.toFixed(0)} V`)}function updateAmperimetro2(e){e<0&&(e=0),e>60&&(e=60),animateNeedle(document.getElementById("ponteiro-amperimetro2"),e/60*260);const t=document.querySelector("#bloco2 .capsula-amperimetro");t&&(t.textContent=`${e.toFixed(0)} A`)}function updateWaterLevel3(e){e<0&&(e=0),e>100&&(e=100);const t=document.querySelector("#bloco3 .water-container"),o=document.getElementById("water-level3");if(!t||!o)return;const a=t.clientHeight,n=.08*a,r=.78*a,c=n+100*Math.pow(e/100,1.2)/100*(r-n);o.style.height=`${c}px`;const l=document.querySelector("#bloco3 .capsula-nivel");l&&(l.textContent=`${e.toFixed(0)}%`)}function updateVoltimetro3(e){e<0&&(e=0),e>300&&(e=300),animateNeedle(document.getElementById("ponteiro-voltimetro3"),e/300*260);const t=document.querySelector("#bloco3 .capsula-voltimetro");t&&(t.textContent=`${e.toFixed(0)} V`)}function updateAmperimetro3(e){e<0&&(e=0),e>60&&(e=60),animateNeedle(document.getElementById("ponteiro-amperimetro3"),e/60*260);const t=document.querySelector("#bloco3 .capsula-amperimetro");t&&(t.textContent=`${e.toFixed(0)} A`)}function animateNeedle(e,t){e.animationFrame&&cancelAnimationFrame(e.animationFrame);let o=parseFloat(e.dataset.angle)||0;const a=(t-o)/40;!function n(){o+=a,a>0&&o>=t||a<0&&o<=t?o=t:e.animationFrame=requestAnimationFrame(n),e.style.transform=`rotate(${o}deg)`,e.dataset.angle=o}()}async function fetchDataFromSupabase(){const{data:e,error:t}=await supabase.from("dados").select("*").eq("id",1383);if(!t)return e&&e.length>0&&updateInterface(e[0].payload.dados),supabase.channel("custom-all-channel").on("postgres_changes",{event:"UPDATE",schema:"public",table:"dados",filter:"id=eq.1383"},(e=>{updateInterface(e.new.dados)})).subscribe();console.error("Erro ao buscar dados do Supabase:",t)}function updateInterface(e){const t=e.Bloco1;if(t){updateWaterLevel1(t.nivel_agua),updateVoltimetro1(t.tensao_bomba),updateAmperimetro1(t.corrente_bomba);const e=document.querySelector("#bloco1 .capsula-status");e&&(e.textContent=t.bomba_ligada?"Bomba Ligada":"Bomba Desligada",e.style.backgroundColor=t.bomba_ligada?"#4CAF50":"#f44336")}const o=e.Bloco2;if(o){updateWaterLevel2(o.nivel_agua),updateVoltimetro2(o.tensao_bomba),updateAmperimetro2(o.corrente_bomba);const e=document.querySelector("#bloco2 .capsula-status");e&&(e.textContent=o.bomba_ligada?"Bomba Ligada":"Bomba Desligada",e.style.backgroundColor=o.bomba_ligada?"#4CAF50":"#f44336")}const a=e.Bloco3;if(a){updateWaterLevel3(a.nivel_agua),updateVoltimetro3(a.tensao_bomba),updateAmperimetro3(a.corrente_bomba);const e=document.querySelector("#bloco3 .capsula-status");e&&(e.textContent=a.bomba_ligada?"Bomba Ligada":"Bomba Desligada",e.style.backgroundColor=a.bomba_ligada?"#4CAF50":"#f44336")}}setInterval(fetchDataFromSupabase,1e3);