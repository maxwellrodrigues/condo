import{supabase}from"./config.js";document.addEventListener("DOMContentLoaded",(()=>{const o=document.getElementById("graficoNiveis");if(!o)return void console.error("Elemento <canvas> com ID 'graficoNiveis' não encontrado.");const a=o.getContext("2d");let l=[],e={Bloco1:[],Bloco2:[],Bloco3:[]},c=new Chart(a,{type:"line",data:{labels:l,datasets:[{label:"Bloco 1",data:e.Bloco1,borderColor:"#3498db",backgroundColor:"rgba(52, 152, 219, 0.2)",borderWidth:2,fill:!0},{label:"Bloco 2",data:e.Bloco2,borderColor:"#2ecc71",backgroundColor:"rgba(46, 204, 113, 0.2)",borderWidth:2,fill:!0},{label:"Bloco 3",data:e.Bloco3,borderColor:"#e74c3c",backgroundColor:"rgba(231, 76, 60, 0.2)",borderWidth:2,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,ticks:{color:"#7c7878",font:{size:10,weight:"bold"},callback:function(o){return o+"%"}},grid:{color:"#B0B0B0"}},x:{ticks:{color:"#7c7878",font:{size:10,weight:"bold"}},grid:{color:"#B0B0B0"}}},plugins:{title:{display:!0,text:"Nível de Água",font:{size:18},color:"#c0c8fd"},legend:{display:!0,position:"top",labels:{font:{size:11},color:"#c0c8fd",padding:10}}}}});async function t(){console.log("Buscando dados do Supabase...");const{data:o,error:a}=await supabase.from("dados").select("*").eq("id",1383);if(a)console.error("Erro ao buscar dados do Supabase:",a);else if(console.log("Dados retornados pelo Supabase:",o),o&&o.length>0){const a=o[0].payload;if(console.log("Payload retornado:",a),a&&a.dados){const t=a.dados;console.log("Dados extraídos do payload:",t);const d={Bloco1:t.Bloco1.nivel_agua,Bloco2:t.Bloco2.nivel_agua,Bloco3:t.Bloco3.nivel_agua},s={Bloco1:e.Bloco1[e.Bloco1.length-1],Bloco2:e.Bloco2[e.Bloco2.length-1],Bloco3:e.Bloco3[e.Bloco3.length-1]};if(d.Bloco1===s.Bloco1&&d.Bloco2===s.Bloco2&&d.Bloco3===s.Bloco3)return void console.log("Dados não mudaram. Gráfico não será atualizado.");if(t.Bloco1){const a=new Date(o[0].recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});l.push(a),e.Bloco1.push(t.Bloco1.nivel_agua),e.Bloco2.push(t.Bloco2.nivel_agua),e.Bloco3.push(t.Bloco3.nivel_agua)}l.length>48&&(l.shift(),e.Bloco1.shift(),e.Bloco2.shift(),e.Bloco3.shift()),console.log("Timestamps:",l),console.log("Histórico de Níveis:",e),c.data.labels=l,c.data.datasets[0].data=e.Bloco1,c.data.datasets[1].data=e.Bloco2,c.data.datasets[2].data=e.Bloco3,c.update()}else console.error("Payload ou objeto 'dados' não encontrado no retorno do Supabase.")}else console.log("Nenhum dado encontrado no Supabase.")}t(),setInterval(t,1e3)}));